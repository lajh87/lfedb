<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Luke Heley">
<meta name="dcterms.date" content="2024-02-22">

<title>Developing LFE Database - What can be learned from the delivery of A400M</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../../site_libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<link href="../../site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="../../site_libs/datatables-binding-0.27/datatables.js"></script>
<script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../site_libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="../../site_libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="../../site_libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
<link href="../../site_libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="../../site_libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="../../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="../../site_libs/pagedtable-1.1/js/pagedtable.js"></script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Developing LFE Database</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/lajh87/lfedb"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">What can be learned from the delivery of A400M</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">gpt</div>
                <div class="quarto-category">a400m</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Luke Heley </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 22, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#objective" id="toc-objective" class="nav-link active" data-scroll-target="#objective">Objective</a></li>
  <li><a href="#background" id="toc-background" class="nav-link" data-scroll-target="#background">Background</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#method" id="toc-method" class="nav-link" data-scroll-target="#method">Method</a></li>
  <li><a href="#findings" id="toc-findings" class="nav-link" data-scroll-target="#findings">Findings</a>
  <ul class="collapse">
  <li><a href="#how-has-the-description-of-the-requirement-changed-between-2009-2015" id="toc-how-has-the-description-of-the-requirement-changed-between-2009-2015" class="nav-link" data-scroll-target="#how-has-the-description-of-the-requirement-changed-between-2009-2015">How has the description of the requirement changed between 2009-2015?</a></li>
  <li><a href="#describe-the-in-year-progress-of-the-a400m-project" id="toc-describe-the-in-year-progress-of-the-a400m-project" class="nav-link" data-scroll-target="#describe-the-in-year-progress-of-the-a400m-project">Describe the in-year progress of the A400M Project</a></li>
  <li><a href="#how-has-the-in-service-date-changed-over-time-and-what-if-any-have-been-the-operational-impacts" id="toc-how-has-the-in-service-date-changed-over-time-and-what-if-any-have-been-the-operational-impacts" class="nav-link" data-scroll-target="#how-has-the-in-service-date-changed-over-time-and-what-if-any-have-been-the-operational-impacts">How has the in-service date changed over time and what, if any, have been the operational impacts?</a></li>
  </ul></li>
  <li><a href="#project-history" id="toc-project-history" class="nav-link" data-scroll-target="#project-history">Project History</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="objective" class="level1">
<h1>Objective</h1>
<p>This article extracts data on what went well and what went less well about the delivery of A400M using the Chat GPT Large Language Model.</p>
</section>
<section id="background" class="level1">
<h1>Background</h1>
<p>This Quarto Markdown document uses both R and Python. It uses the r package <code>reticulate</code> to transfer data between the two languages.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reticulate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="data" class="level1">
<h1>Data</h1>
<p>Data are sourced from major project reports between 2006 and 2015.</p>
<p>The tables below show the headings in the difference reports by section.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>project_section <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"../../data-raw/naomprss/page_splits_manual_labels.csv"</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">show_col_types =</span> <span class="cn">FALSE</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>section_lu <span class="ot">&lt;-</span> project_section <span class="sc">|&gt;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(project_label <span class="sc">==</span> <span class="st">"A400M"</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(year<span class="sc">&gt;=</span><span class="dv">2006</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">pmap</span>(<span class="cf">function</span>(year, page_from, page_to, ...){</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    filepath <span class="ot">&lt;-</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"../../data-raw/naomprss/naomprss_{year}_{page_from}_{page_to}.md"</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    text <span class="ot">&lt;-</span> <span class="fu">readLines</span>(filepath)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    is_heading <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_detect</span>(text, <span class="st">"^#</span><span class="sc">\\</span><span class="st">s|^##</span><span class="sc">\\</span><span class="st">s"</span>)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    heading <span class="ot">&lt;-</span> text[is_heading]</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    start <span class="ot">&lt;-</span> <span class="fu">which</span>(is_heading)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    end <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">tail</span>(start, <span class="sc">-</span><span class="dv">1</span>)<span class="sc">-</span><span class="dv">1</span>, <span class="fu">length</span>(text))</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    level <span class="ot">&lt;-</span> <span class="fu">nchar</span>(stringr<span class="sc">::</span><span class="fu">str_extract</span>(heading, <span class="st">"^#*</span><span class="sc">\\</span><span class="st">s"</span>))<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    chars <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">pmap</span>(<span class="fu">list</span>(start, end), <span class="cf">function</span>(start, end){</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">nchar</span>(<span class="fu">paste</span>(text[start<span class="sc">:</span>end], <span class="at">collapse =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    })  <span class="sc">|&gt;</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unlist</span>()</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">tibble</span>(year, level, heading, start, end, chars) <span class="sc">|&gt;</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">section =</span> <span class="fu">cumsum</span>(stringr<span class="sc">::</span><span class="fu">str_detect</span>(heading, <span class="st">"^#</span><span class="sc">\\</span><span class="st">s"</span>)), <span class="at">.before =</span> <span class="dv">2</span>) </span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  }) <span class="sc">|&gt;</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>()  <span class="sc">|&gt;</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">common_label =</span> <span class="fu">tolower</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(stringr<span class="sc">::</span><span class="fu">str_split</span>(heading, <span class="st">"</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">s|:</span><span class="sc">\\</span><span class="st">s"</span>), <span class="sc">~</span>.x[<span class="dv">2</span>]))) <span class="sc">|&gt;</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">common_label =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(common_label), heading, common_label))</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>section_lu <span class="sc">|&gt;</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(section, year, common_label, chars) <span class="sc">|&gt;</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">common_label =</span> stringr<span class="sc">::</span><span class="fu">str_remove</span>(common_label, <span class="st">" – not applicable| - n</span><span class="sc">\a</span><span class="st">| – n/a|/pfi$"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(section) <span class="sc">|&gt;</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> year, <span class="at">values_from =</span> chars, <span class="at">values_fn =</span> sum) <span class="sc">|&gt;</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>  DT<span class="sc">::</span><span class="fu">datatable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-560c0b941776aa30fc21" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-560c0b941776aa30fc21">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106"],[1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5],["about the project","project description, progress and key future events","associated projects","procurement strategy","section a","the requirement","the assessment phase","progress","capability risks","support strategy","project history","in-year progress","project costs","performance against approved cost","reasons for variation from approved cost","expenditure to date","unit production cost","section b","cost of the assessment phase","planned/actual cost boundaries for demonstration and manufacture phase","cost boundaries of the demonstration and manufacture (d&amp;m) phase","progress against approved support/pfi cost - not applicable","planned / actual cost boundaries for demonstration and manufacture phase / pfi","cost of the demonstration and manufacture phase","progress against approved support / service / pfi cost","cost variation against approved cost of the demonstration &amp; manufacture phase b.3.1.1 a400m","operational impact of cost variations of demonstration &amp;","unit production cost/quantities required","actual cost boundaries for demonstration and manufacture phase /","cost variation against approved cost of the demonstration and manufacture phase","operational impact of cost variations of demonstration and manufacture phase","progress against approved support / pfi cost","actual cost boundaries for demonstration and manufacture phase / pfi","operational impact of cost variations of demonstration and manufacture phase - n/a","cost variation against approved support / pfi cost - n/a","operational impact on support / pfi cost - n/a","cost boundaries for demonstration and manufacture phase / pfi","cost variation against approved cost of the demonstration &amp; manufacture phase","progress against approved support / training / pfi cost","cost variation against approved support / training / pfi cost","operational impact of support / training / pfi cost variations –","cost variation against approved cost of the demonstration &amp;","project timescale","definition of in-service date","performance against approved in-service date","reasons for variation from approved isd","cost resulting from isd variation","operational impact of isd variation","section c","duration of the assessment phase","planned / actual boundaries for introduction of the capability","in service date","definition","progress against approved dates","timescale variation","initial operating capability","full operating capability","support / service / pfi contract","in-service date","planned / actual boundaries for in service date or initial operating capability","in-service date/initial operating capability","other costs / savings resulting from timescale variation","operational impact of in-service date/initial operating capability variation","length of the assessment phase","actual boundaries for in service date or initial operating capability","support / pfi contract","full operating capability - n/a","scope of support / pfi contract","progress against approved support / pfi contract go-live date","progress against approved support / pfi contract end date","other costs / savings resulting from support cost variation -","operational impact of support / pfi support contract variation -","other costs resulting from timescale variation","support / training / pfi contract","scope of support / training / pfi contract","progress against approved support / training / pfi contract go-live date","progress against approved end of support / training / pfi contract date","other costs resulting from support cost variation","operational impact of support / training / pfi support contract variation","key user requirements","performance against approved key user requirements","reasons for variation against approved key requirements","section d","readiness levels","performance against lines of development","performance against key performance measures","maturity measures","performance against defence lines of development","defence line of development variation","a400m","support contract","sentinel score","training service","performance against defence lines of development (dlod)","defence lines of development variation","performance against key performance measures (kpm)","project/increment","support and training contract","training","in-service support","history up to main gate approval","description of the assessment phase","cost of the assessment phase","duration of assessment phase","cost boundaries at initial gate and main gate approvals","isd boundaries at initial gate and main gate approvals"],[31,1355,497,526,null,null,null,null,null,null,null,null,27,458,6708,352,462,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,31,305,454,973,499,168,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,35,1437,394,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,46,2122,526,347,629,115],[31,1331,495,532,null,null,null,null,null,null,null,null,27,458,6502,352,464,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,31,305,455,914,396,201,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,35,1434,246,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,46,1574,526,347,629,620],[31,1352,497,532,null,null,null,null,null,null,null,null,27,457,7353,352,464,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,31,305,459,1030,487,196,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,35,1470,392,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,46,1649,590,347,611,632],[null,null,45,1017,28,1320,1639,957,709,513,null,null,null,null,null,null,585,21,789,512,9479,68,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,26,462,520,24,337,511,2866,392,51,58,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,28,632,3023,2560,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,45,919,28,1170,1627,2968,544,614,null,null,null,null,null,717,585,21,879,null,null,null,591,11014,80,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,26,493,520,null,null,null,null,null,51,58,3768,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,28,null,null,1893,929,3412,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,28,704,28,1168,1618,1702,611,765,null,null,null,null,null,712,null,21,948,null,null,null,587,610,63,11182,85,49,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,26,537,null,null,402,546,1654,null,34,null,null,566,53,685,626,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,28,null,null,53,210,1904,1381,1558,24,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,366,735,28,1166,1616,null,1139,672,3731,1430,null,null,null,707,null,21,874,null,null,null,null,607,null,null,null,null,516,12097,377,53,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,26,null,null,null,730,524,1652,null,34,null,null,null,53,664,624,510,471,45,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,28,null,null,53,null,1840,1573,1578,31,320,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,28,621,28,1166,1618,null,1050,2408,4882,2153,null,null,null,1682,null,21,925,null,null,null,null,603,null,null,null,null,null,9587,null,605,519,93,67,57,null,null,null,null,null,null,null,null,null,null,null,null,26,null,null,null,402,519,1640,null,null,null,null,null,53,667,624,491,471,31,40,409,925,916,76,79,null,null,null,null,null,null,null,null,null,null,28,null,null,53,null,1904,1762,2673,25,391,3812,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,34,618,28,1166,1616,null,1050,2424,7003,2852,null,null,null,1015,null,21,547,null,null,null,null,598,null,null,91,null,null,null,null,null,null,null,null,null,355,9630,534,139,79,null,null,null,null,null,null,null,26,null,null,null,403,515,1622,null,40,null,null,478,53,null,626,511,null,null,null,null,null,null,null,null,292,42,427,605,614,66,84,null,null,null,28,null,null,null,null,null,null,2495,25,470,null,1926,2226,59,3759,null,null,null,null,null,null,null,null,null],[null,null,34,618,28,1172,1616,null,1051,3975,9617,3212,null,null,null,806,null,21,619,null,null,null,null,594,null,null,91,null,null,null,null,null,null,null,null,null,355,null,629,2610,79,6655,null,null,null,null,null,null,26,null,null,null,403,523,1835,null,40,null,null,478,53,null,1033,511,null,null,null,null,null,null,null,null,292,42,427,718,729,66,90,null,null,null,28,null,null,null,null,null,null,2448,null,558,null,1900,2784,59,null,38,3581,2282,null,null,null,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>section<\/th>\n      <th>common_label<\/th>\n      <th>2006<\/th>\n      <th>2007<\/th>\n      <th>2008<\/th>\n      <th>2009<\/th>\n      <th>2010<\/th>\n      <th>2011<\/th>\n      <th>2012<\/th>\n      <th>2013<\/th>\n      <th>2014<\/th>\n      <th>2015<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,3,4,5,6,7,8,9,10,11,12]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="method" class="level1">
<h1>Method</h1>
<p>If we want to extract a commentary of the project history and progress the tables above show that between 2006-2008 is was captured under the heading ‘project description, progress and key future events’, between 2009-2011 it appears to be captured under the heading ‘progress’ and from 2012-2015 it is split into two sections: ‘project history’ and ‘in-year’ progress.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>about_sections <span class="ot">&lt;-</span> section_lu <span class="sc">|&gt;</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    common_label <span class="sc">%in%</span> <span class="fu">c</span>(</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">"project description, progress and key future events"</span>, </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">"progress"</span>, <span class="st">"the requirement"</span>, <span class="st">"project history"</span>, </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">"in-year progress"</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    )  <span class="sc">|&gt;</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(year, start, end, common_label)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>files <span class="ot">&lt;-</span> project_section <span class="sc">|&gt;</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(project_label <span class="sc">==</span> <span class="st">"A400M"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(year<span class="sc">&gt;=</span><span class="dv">2006</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">pmap_df</span>(<span class="cf">function</span>(year, page_from, page_to, ...){</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    file <span class="ot">=</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"naomprss_{year}_{page_from}_{page_to}.md"</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    filepath <span class="ot">=</span> <span class="fu">file.path</span>(<span class="st">"../../data-raw/naomprss"</span>, file)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">tibble</span>(filepath, year)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>about_files <span class="ot">&lt;-</span> about_sections <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(files, <span class="at">by =</span> <span class="st">"year"</span>)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>text <span class="ot">&lt;-</span> about_files <span class="sc">|&gt;</span> </span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">pmap_df</span>(<span class="cf">function</span>(year, start, end, common_label, filepath){</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  text <span class="ot">=</span> <span class="fu">readLines</span>(filepath)[start<span class="sc">:</span>end] <span class="sc">|&gt;</span> </span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(<span class="at">collapse =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">tibble</span>(year, common_label, text)</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>To generate text based on the data a function is created that includes the question and context from the text data into the GPT prompt window.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>query_gpt <span class="ot">&lt;-</span> <span class="cf">function</span>(question, context, </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">key =</span> <span class="fu">Sys.getenv</span>(<span class="st">"OPENAI_API_KEY"</span>), </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">model =</span> <span class="st">"gpt-4-0613"</span>){</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  PROMPT <span class="ot">&lt;-</span> glue<span class="sc">::</span><span class="fu">glue</span>(</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Answer the following QUESTION, based on the following CONTEXT."</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"If you do not know the answer say 'Unable to determine from context."</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Do not try to make something up."</span>, </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"The context are delimited by '</span><span class="sc">\n</span><span class="st">```</span><span class="sc">\n</span><span class="st">'."</span>,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"QUESTION: {question}"</span>,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CONTEXT: {context}"</span>,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">.sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  body <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">model =</span> model,</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">messages =</span> <span class="fu">list</span>(<span class="fu">list</span>(</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>          <span class="at">role =</span> <span class="st">"user"</span>,</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>          <span class="at">content =</span> PROMPT</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>       )),</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">temperature =</span> <span class="fl">0.3</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    jsonlite<span class="sc">::</span><span class="fu">toJSON</span>(<span class="at">auto_unbox =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  resp <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">POST</span>(</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">url =</span> <span class="st">"https://api.openai.com/v1/chat/completions"</span>,</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    httr<span class="sc">::</span><span class="fu">add_headers</span>(</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Content-Type</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"application/json"</span>,</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">Authorization =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"Bearer {key}"</span>)</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">body =</span> body</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>  httr<span class="sc">::</span><span class="fu">content</span>(resp)</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>For more advanced queries a Retrieval Augmented Generation (RAG) process using Chromadb.</p>
<p>First the text is processed and outputted as json.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>all_text <span class="ot">&lt;-</span> section_lu <span class="sc">|&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(files, <span class="at">by =</span> <span class="st">"year"</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">pmap_df</span>(<span class="cf">function</span>(year, start, end, common_label, filepath,section, ...){</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    text <span class="ot">=</span> <span class="fu">readLines</span>(filepath)[start<span class="sc">:</span>end] <span class="sc">|&gt;</span> </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(<span class="at">collapse =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">tibble</span>(year, section, common_label, text)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  }) <span class="sc">|&gt;</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>stringr<span class="sc">::</span><span class="fu">str_detect</span>(text, <span class="st">"^#</span><span class="sc">\\</span><span class="st">s"</span>))</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>meta <span class="ot">&lt;-</span> all_text <span class="sc">|&gt;</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(year, section, common_label) <span class="sc">|&gt;</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  jsonlite<span class="sc">::</span><span class="fu">toJSON</span>()</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>documents <span class="ot">&lt;-</span> all_text <span class="sc">|&gt;</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(text) <span class="sc">|&gt;</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  jsonlite<span class="sc">::</span><span class="fu">toJSON</span>()</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>ids <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"id"</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(all_text))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The text is then stored along with embeddings from the open ai ada2 model.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>meta <span class="op">=</span> json.loads(r.meta)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>docs <span class="op">=</span> json.loads(r.documents)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> chromadb</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> chromadb.utils.embedding_functions <span class="im">as</span> embedding_functions</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>openai_ef <span class="op">=</span> embedding_functions.OpenAIEmbeddingFunction(</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>                api_key<span class="op">=</span>os.getenv(<span class="st">"OPENAI_API_KEY"</span>),</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>                model_name<span class="op">=</span><span class="st">"text-embedding-ada-002"</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>chroma_client <span class="op">=</span> chromadb.Client()</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>collection <span class="op">=</span> chroma_client.get_or_create_collection(</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  name<span class="op">=</span><span class="st">"my_collection"</span>, </span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  embedding_function<span class="op">=</span>openai_ef</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>collection.add(</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    documents<span class="op">=</span>docs,</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    metadatas<span class="op">=</span>meta,</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    ids<span class="op">=</span>r.ids</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>q_resp <span class="op">=</span> collection.query(</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    query_texts<span class="op">=</span>[<span class="st">"What is the forecast in-service date (ISD)?"</span>],</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    n_results<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    where<span class="op">=</span>{<span class="st">"year"</span>: <span class="dv">2006</span>}</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="co">'"""'</span>.join(q_resp[<span class="st">"documents"</span>][<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="findings" class="level1">
<h1>Findings</h1>
<section id="how-has-the-description-of-the-requirement-changed-between-2009-2015" class="level2">
<h2 class="anchored" data-anchor-id="how-has-the-description-of-the-requirement-changed-between-2009-2015">How has the description of the requirement changed between 2009-2015?</h2>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>context <span class="ot">&lt;-</span> text <span class="sc">|&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(common_label <span class="sc">==</span> <span class="st">"the requirement"</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">text =</span> <span class="fu">paste</span>(<span class="st">"project: 'A400m'</span><span class="sc">\n</span><span class="st">year:"</span>,year,<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                             text)) <span class="sc">|&gt;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(text)  <span class="sc">|&gt;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="at">collapse =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">```</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>question <span class="ot">&lt;-</span> <span class="st">"How has the description of the requirement for A400M changed over time?"</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>q_1 <span class="ot">&lt;-</span> <span class="fu">query_gpt</span>(question, context)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(q_1, <span class="st">"q_1.RDS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>q_1 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"q_1.RDS"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>q_1<span class="sc">$</span>choices[[<span class="dv">1</span>]]<span class="sc">$</span>message<span class="sc">$</span>content</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The description of the requirement for A400M has not changed over time. It has consistently been described as a vehicle intended to provide tactical and strategic mobility to all three services, with the ability to operate from airfields and semi-prepared rough landing areas in extreme climates and all weather conditions by day and night. It is also required to carry a variety of equipment including vehicles and troops over extended ranges, air drop paratroops and equipment, and be unloaded with the minimum of ground handling equipment. The A400M is also intended to replace the remaining Hercules C-130k fleet."</code></pre>
</div>
</div>
</section>
<section id="describe-the-in-year-progress-of-the-a400m-project" class="level2">
<h2 class="anchored" data-anchor-id="describe-the-in-year-progress-of-the-a400m-project">Describe the in-year progress of the A400M Project</h2>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>context <span class="ot">&lt;-</span> text <span class="sc">|&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> glue<span class="sc">::</span><span class="fu">glue</span>(</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">"project: A400M"</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">"year: {year}"</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">"{text}"</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">.sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">text =</span> <span class="fu">paste</span>(text, <span class="at">collapse =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">```</span><span class="sc">\n</span><span class="st">"</span>)) </span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>in_year_summary <span class="ot">&lt;-</span> <span class="dv">2006</span><span class="sc">:</span><span class="dv">2015</span> <span class="sc">|&gt;</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="sc">~</span>{</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    context_ <span class="ot">&lt;-</span> context <span class="sc">|&gt;</span> </span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(year <span class="sc">==</span> .x) <span class="sc">|&gt;</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">pull</span>(text)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    question <span class="ot">&lt;-</span> glue<span class="sc">::</span><span class="fu">glue</span>(</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Summarise the in year progress for A400M in year:{.x}"</span>,</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Describe what when went, what went less well and what can be improved."</span>,</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">.sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">query_gpt</span>(question, context_)</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(in_year_summary, <span class="st">"q_2.RDS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>in_year_summary <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"q_2.RDS"</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>in_year_summary <span class="sc">|&gt;</span> purrr<span class="sc">::</span><span class="fu">map</span>(<span class="sc">~</span>.x<span class="sc">$</span>choices[[<span class="dv">1</span>]]<span class="sc">$</span>message<span class="sc">$</span>content)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "In 2006, the A400M project, a collaborative programme involving seven European nations, was in its design phase which was nearing completion. Manufacturing activities had also commenced. The project aims to provide tactical and strategic mobility to all three services, with capabilities including operations from airfields and semi-prepared rough landing areas in extreme climates and all weather conditions, carrying a variety of equipment over extended ranges, air dropping paratroops and equipment, and being unloaded with minimum ground handling equipment. The first flight was scheduled for 2008 and the first UK aircraft was expected to be delivered to the Royal Air Force in 2010. The context does not provide specific details on what went well or less well in 2006, or what could be improved."

[[2]]
[1] "In 2007, the A400M project was in its design phase, nearing completion, and manufacturing activities had begun. The project was a collaboration between seven European nations, with a total of 180 aircraft being procured, 25 of which were for the UK. The A400M was selected to meet the airlift capability requirements of the Strategic Defence Review, and is planned to replace the remaining Hercules C-130k fleet. The first flight was scheduled for 2008 and the first UK aircraft was scheduled to be delivered to the Royal Air Force in 2010. The context does not provide specific details on what went well or less well, or what could be improved in 2007."

[[3]]
[1] "The A400M project in 2008 was in the design phase, nearing completion, and manufacturing activities had begun. The project involves seven European nations with a total of 180 aircraft being procured, 25 of which are for the UK. The A400M is expected to provide tactical and strategic mobility to all three services, with capabilities such as operating from airfields and semi-prepared rough landing areas in extreme climates and all weather conditions. It is also expected to carry a variety of equipment including vehicles and troops over extended ranges, air drop paratroops and equipment, and be unloaded with minimum ground handling equipment. The first flight was expected in the financial year 2008-2009 and delivery of the first UK aircraft to the Royal Air Force in the financial year 2010-2011. The context does not provide specific information on what went less well and what can be improved in 2008."

[[4]]
[1] "In 2009, the A400M project faced significant challenges. Airbus announced delays in the delivery date and a slowdown in the initial aircraft production rates. The first flight of the prototype aircraft, initially due in January 2008, was postponed until the second half of 2009. In December 2008, Airbus proposed a new approach to the A400M programme, which included revising the production schedule. However, full details of the revised schedule were still to be provided. Based on preliminary information, it was estimated that initial UK deliveries could not start before 2013. Despite these setbacks, there were positive developments, such as the roll-out of the first prototype aircraft at the Airbus Military Final Assembly Line Facility in Seville in June 2008 and the first flight of the specially developed TP-400D engine on the Flying Test Bed in late December 2008. By the end of March 2009, six flights of the Flying Test Bed had occurred."

[[5]]
[1] "In 2010, the A400M project saw the first flight of the prototype in December 2009, and the continuation of flight trials in March 2010. However, the project faced challenges, with Airbus announcing in November 2008 that the first flight might not happen until the second half of 2009. In January 2009, Airbus proposed a new approach to the program and announced that they wished to discuss the program schedule and certain technical characteristics of the aircraft with customers. The UK and its partner nations agreed to a \"standstill\" agreement with Airbus Military to discuss possible options and outcomes for the A400M program. The renegotiation phase revealed that the A400M program would only remain viable with further investment from partner nations. The UK managed this additional funding through a reduction in the number of aircraft it receives. The principal factor for the delay to the program was its technical complexity, and poor management and control by Airbus Military. The program remained in a volatile and uncertain position while negotiations towards a revised contract continued. The Department planned to carry out a thorough review of the program later in 2010 when the revised program was established."

[[6]]
[1] "In 2011, the A400M project, a collaborative programme involving seven European nations, was progressing towards its goal of providing tactical and strategic mobility to all three services. The design phase was nearing completion and manufacturing activities had begun. The first UK aircraft was expected to be delivered to the Royal Air Force in 2014.\n\nThe Strategic Defence and Security Review in October 2010 confirmed A400M as a component of the future RAF Air Transport Fleet. It also announced the earlier withdrawal of the Hercules C-130j Tactical Air Transport Aircraft from service in 2022 instead of 2030. \n\nIn March 2010, an agreement was reached to re-baseline the programme, setting the framework for contract amendment negotiations. These negotiations continued until November 2010, with the amended contract signed on 7 April 2011. As a result, the UK would receive 22 A400M, three less than originally expected.\n\nPositive achievements in 2011 included the addition of three more prototype aircraft to the flight trials fleet, which had amassed over 1404 flying hours by 27 March 2011. The A400M made its first visit to the UK, landing at its future main operating base RAF Brize Norton on 16 July 2010."

[[7]]
[1] "In 2012, the A400M project made steady progress, with the revised aircraft production and delivery schedules remaining on track. Quarterly review meetings indicated that Airbus Military was making consistent progress. Investigation into engine problems encountered in 2011 concluded and solutions were developed, causing some disruption to the flight trials programme but not expected to significantly impact the aircraft production schedule. By the end of March 2012, all flight trials associated with the initial type certificate clearance, except for long distance endurance flying, were completed. The European Aviation Safety Agency granted a restricted type certificate in late April 2012. The first flight of the fifth and final prototype aircraft took place on 20 December 2011, and by 25 March 2012, the trials fleet had amassed 2944 flying hours and 1002 test flights."

[[8]]
[1] "In 2013, the UK A400M Training Service achieved Main Gate Approval and will now be reported as a separate increment to the main A400M Programme. The original Main Gate Approval, which included elements of initial training and initial in-service support, was separated out and the A400M budgeted for and highest approved figures were adjusted to reflect this change. In anticipation of the achievement of UK A400M in Service Support Main Gate Approval later in the year, these elements of the original Main Gate Approval were also extracted. \n\nAt the Farnborough International Airshow in July 2012, it was announced that an order for the first UK A400M Full Flight Simulator had been agreed. On 4 March 2013, two further contracts relating to the A400M Programme were placed. The Training Service Support Contract will provide a specialist training school for personnel who will operate, support and maintain the A400M. A separate contract for the development, manufacture and installation of modifications required to operate the Large Aircraft Infrared Countermeasures Defensive Aids System when flying in hostile environments has also been let. \n\nThe European Aviation Safety Agency granted a Full Type Certificate to A400M on 13 March 2013 after the conclusion of all of the required flight trials activity. \n\nThe progress of the project could be improved by avoiding delays and ensuring that all necessary approvals and contracts are in place in a timely manner. The project could also benefit from a more streamlined and efficient process for the development, manufacture and installation of necessary modifications."

[[9]]
[1] "In 2014, the A400M project saw significant progress with the delivery of the first two A400M Atlas aircrafts to France, marking important milestones in the multinational aircraft production and delivery programme. The multinational flight trials programme had amassed over 6,000 flying hours by the end of March 2014, providing further evidence of the capability and design maturity of the new aircraft. The UK was set to receive two of its order of 22 A400M Atlas aircraft earlier than previously planned due to an exchange of two aircraft production slots with France. However, UK aircraft deliveries were still forecast to commence in the latter part of 2014. The A400M Schoolhouse at RAF Brize Norton was completed on schedule and accepted off contract on 28 March 2014. \n\nHowever, the A400M in Service Support Main Gate Business Case was still awaiting final endorsement and approval by Ministers and Her Majesty’s Treasury at the end of March 2014. Consequently, in Service Support was not reported as an increment in the year's report. Approval of the Business Case was anticipated early in the next financial year. \n\nFor improvement, the project could benefit from faster approval processes to ensure that all aspects of the project, including in Service Support, are included in the annual report."

[[10]]
[1] "In 2015, progress for the A400M project included the delivery of the first UK aircraft, ZM400, to RAF Brize Norton in November 2014. The UK became the third partner nation to operate the A400M. The aircraft was officially named “City of Bristol” in a ceremony held in February 2015. The second RAF A400M aircraft, ZM402, arrived at RAF Brize Norton in February 2015. However, there were issues with the A400M programme and a revised baseline and delivery schedule was announced by the Airbus Group in February 2015. The UK revised its forecast of achievement of in service date from March to September 2015 due to these delays. The first A400M export customer, Malaysia, took delivery of MSN022 in March 2015."</code></pre>
</div>
</div>
</section>
<section id="how-has-the-in-service-date-changed-over-time-and-what-if-any-have-been-the-operational-impacts" class="level2">
<h2 class="anchored" data-anchor-id="how-has-the-in-service-date-changed-over-time-and-what-if-any-have-been-the-operational-impacts">How has the in-service date changed over time and what, if any, have been the operational impacts?</h2>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>tbls <span class="ot">&lt;-</span> all_text <span class="sc">|&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(section <span class="sc">==</span> <span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">text =</span> <span class="fu">paste</span>(text, <span class="at">collapse =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(text) <span class="sc">|&gt;</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(rvest<span class="sc">::</span>read_html) <span class="sc">|&gt;</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(rvest<span class="sc">::</span>html_table) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>tbls[[<span class="dv">10</span>]][[<span class="dv">3</span>]][,<span class="dv">2</span>] <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">pull</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "In-Service Date Defined as Delivery of the Seventh Aircraft with Military Aircraft Release and Support Arrangements."</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>isd <span class="ot">&lt;-</span> tbls <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">imap</span>(<span class="sc">~</span>{</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(.y<span class="sc">&lt;=</span><span class="dv">3</span>){</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">t</span>(.x[[<span class="dv">2</span>]]) <span class="sc">|&gt;</span> </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">as_tibble</span>(<span class="at">.name_repair =</span> <span class="st">"universal"</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>        rlang<span class="sc">::</span><span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">"forecast_isd"</span>, <span class="st">"approved_isd"</span>, </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"variation"</span>, <span class="st">"var_in_year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">project =</span> <span class="st">"a400m"</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>        purrr<span class="sc">::</span><span class="fu">map</span>(as.character) <span class="sc">|&gt;</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">as_tibble</span>()</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>      .x[[<span class="dv">4</span>]]  <span class="sc">|&gt;</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>        rlang<span class="sc">::</span><span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">"project"</span>,  <span class="st">"approved_isd"</span>, <span class="st">"forecast_isd"</span>,</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"variation"</span>, <span class="st">"var_in_year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>        purrr<span class="sc">::</span><span class="fu">map</span>(as.character) <span class="sc">|&gt;</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">as_tibble</span>()</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  }) <span class="sc">|&gt;</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>() <span class="sc">|&gt;</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">report =</span> <span class="dv">2006</span><span class="sc">:</span><span class="dv">2015</span>)</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>isd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["forecast_isd"],"name":[1],"type":["chr"],"align":["left"]},{"label":["approved_isd"],"name":[2],"type":["chr"],"align":["left"]},{"label":["variation"],"name":[3],"type":["chr"],"align":["left"]},{"label":["var_in_year"],"name":[4],"type":["chr"],"align":["left"]},{"label":["project"],"name":[5],"type":["chr"],"align":["left"]},{"label":["report"],"name":[6],"type":["int"],"align":["right"]}],"data":[{"1":"March 2011","2":"December 2009","3":"15","4":"0","5":"a400m","6":"2006"},{"1":"March 2011","2":"December 2009","3":"+15","4":"0","5":"a400m","6":"2007"},{"1":"December 2011","2":"December 2009","3":"+24","4":"+9","5":"a400m","6":"2008"},{"1":"December 2015","2":"December 2009","3":"72","4":"48","5":"a400m","6":"2009"},{"1":"march 2015","2":"December 2009","3":"63","4":"-9","5":"a400m","6":"2010"},{"1":"march 2015","2":"february 2009","3":"73","4":"0","5":"a400m","6":"2011"},{"1":"march 2015","2":"february 2009","3":"73","4":"0","5":"a400m","6":"2012"},{"1":"march 2015","2":"february 2009","3":"73","4":"0","5":"a400m","6":"2013"},{"1":"march 2015","2":"february 2009","3":"73","4":"0","5":"a400m","6":"2014"},{"1":"September 2015","2":"february 2009","3":"79","4":"6","5":"a400m","6":"2015"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>The approved ISD was February 2009 (<span class="citation" data-cites="50">@50</span>%) <span class="citation" data-cites="90">[December 2009 @90%]</span>.</p>
<p>The reason for the variation is in the table below.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>purrr<span class="sc">::</span><span class="fu">imap</span>(tbls, <span class="sc">~</span>{</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  tbl <span class="ot">&lt;-</span> <span class="cf">if</span>(.y<span class="sc">&lt;=</span><span class="dv">3</span>) .x[[<span class="dv">3</span>]] <span class="cf">else</span> .x[[<span class="dv">5</span>]]</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(tbl) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"date"</span>, <span class="st">"var"</span>, <span class="st">"category"</span>, <span class="st">"reason"</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(.y <span class="sc">==</span> <span class="dv">1</span>) tbl <span class="cf">else</span> tbl <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(date <span class="sc">!=</span> <span class="st">"historic"</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">|&gt;</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>() <span class="sc">|&gt;</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>( <span class="sc">!</span>stringr<span class="sc">::</span><span class="fu">str_detect</span>(<span class="fu">tolower</span>(date), <span class="st">"net|total"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(category <span class="sc">!=</span> <span class="st">"Risk Differential"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["date"],"name":[1],"type":["chr"],"align":["left"]},{"label":["var"],"name":[2],"type":["int"],"align":["right"]},{"label":["category"],"name":[3],"type":["chr"],"align":["left"]},{"label":["reason"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"Historic","2":"16","3":"Changed Budgetary Priorities","4":"change in the Customer’s Requirement Flowing from Changed Budgetary Priorities (+16 Months)."},{"1":"Historic","2":"9","3":"procurement Strategy","4":"delay in Bringing Contract into Effect as a Result of Delayed Approvals in Germany (+9 Months)."},{"1":"february 2008","2":"9","3":"Technical Factors","4":"contractor Delay to Aircraft Delivery"},{"1":"march 2009","2":"NA","3":"Technical Factors","4":"Updated Programme Estimate Based Upon A400M Task Force Outputs and Air Support Cluster Assessment."},{"1":"january 2009","2":"NA","3":"Technical Factors","4":"Updated Programme Proposal Received from Airbus Military, Including Revised Production Approach."},{"1":"october 2008","2":"NA","3":"Technical Factors","4":"Programme Delays Affecting Engine and Aircraft First Flight."},{"1":"september 2008","2":"NA","3":"Technical Factors","4":"Reflects Latest Delay and Risk Assessment Beyond First Flight."},{"1":"March 2010","2":"NA","3":"Procurement","4":"A Change Due to Programme  Processes Rebalancing (International Collaboration)."},{"1":"january 2015","2":"6","3":"Technical Factors","4":"updated Programme Estimate Based on an Assessment of the Airbus Defence & Space Revised Delivery Schedule."}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>tbls[[<span class="dv">10</span>]][[<span class="dv">6</span>]][,<span class="dv">2</span>] <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">pull</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Reported in MPR 2015: The Further Six Month Delay to the UK Declaration of in Service Date is not Expected to Have any Direct Impact on the Delivery of UK Military Capability. Delivery Dates for Future Capability Increments Forecast by Airbus Defence and Space are not Affected by Current Production Delays, and Align with UK Capability Milestones."
[2] "Reported in MPR 2009: The Revised Forecast A400M in Service Date No Longer Aligns with the C-130k Out of Service Date of 2013. This Increases the Pressure on Existing Tactical Airlift Capability from 2013 to 2015. Interim Measures to Mitigate this Include Action to Increase the Availability of the Remaining C-130j Fleet."                          </code></pre>
</div>
</div>
</section>
</section>
<section id="project-history" class="level1">
<h1>Project History</h1>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#|eval: false</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>context <span class="ot">&lt;-</span> all_text <span class="sc">|&gt;</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(common_label <span class="sc">==</span> <span class="st">"project history"</span>) <span class="sc">|&gt;</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice_tail</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(text)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>question <span class="ot">&lt;-</span> <span class="st">"List the events and their associated dates."</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>history <span class="ot">&lt;-</span> <span class="fu">query_gpt</span>(question, context)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(history, <span class="st">"history.RDS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>history <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"history.RDS"</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>history<span class="sc">$</span>choices[[<span class="dv">1</span>]]<span class="sc">$</span>message<span class="sc">$</span>content <span class="sc">|&gt;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  stringr<span class="sc">::</span><span class="fu">str_split</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
 [1] "- On 18 May 2000, the Investment Approvals Board approved the acquisition of 25 A400M Aircraft with an in-service date of December 2009."                    
 [2] "- On 8 May 2003, the Investment Approvals Board revised the in-service date to December 2011."                                                               
 [3] "- On 21 May 2003, approval was granted for the multinational contract."                                                                                      
 [4] "- On 27 May 2003, the A400M Development and Production Phase Contract was signed."                                                                           
 [5] "- On 27 May 2006, the Investment Approvals Board granted Initial Gate Approval and the A400M in Service Support Assessment Phase commenced."                 
 [6] "- On 26 June 2008, the first complete A400M Aircraft was rolled out."                                                                                        
 [7] "- On 25 September 2008, Airbus announced a delay to the first flight of the A400M Prototype Aircraft."                                                       
 [8] "- On 17 December 2008, the first flight of the A400M Flying Test Bed took place."                                                                            
 [9] "- On 19 December 2008, Airbus Military sent a revised production schedule to OCCAR."                                                                         
[10] "- On 9 January 2009, Airbus Military proposed a new approach to the A400M Programme."                                                                        
[11] "- On 12 March 2009, a meeting of A400M Partner Nation Defence Ministers agreed to a standstill agreement with Airbus Military."                              
[12] "- On 11 December 2009, the first flight of MSN001 took place."                                                                                               
[13] "- On 12 March 2010, the Investment Approvals Board reapproved the UK A400M Programme with a revised in-service date of 2015."                                
[14] "- On 29 March 2010, an agreement had been reached between A400M Partner Nations and Airbus Military on the future of the Programme."                         
[15] "- On 31 March 2010, the Heads of Terms were signed."                                                                                                         
[16] "- On 8 April 2010, the first flight of MSN002 took place."                                                                                                   
[17] "- On 9 July 2010, the first flight of MSN003 took place."                                                                                                    
[18] "- On 19 October 2010, the Strategic Defence and Security Review Announcement stated that A400M would be a key element of the RAF Future Air Transport Fleet."
[19] "- On 5 November 2010, the Substantive Contract Amendment was agreed by Partner Nations' Representatives."                                                    
[20] "- On 20 December 2010, the first flight of MSN004 took place."                                                                                               
[21] "- On 7 April 2011, the Amended Development and Production Phase Contract was signed."                                                                        
[22] "- On 20 December 2011, the first flight of MSN006 took place."                                                                                               
[23] "- On 30 April 2012, the European Aviation Safety Agency granted a Restricted Type Certificate to A400M."                                                     
[24] "- In July 2012, the UK A400M Training Service achieved Main Gate Approval."                                                                                  
[25] "- In July 2012, the Prime Minister announced that an order for the first UK A400M Full Flight Simulator had been agreed."                                    
[26] "- On 4 March 2013, two further contracts relating to the A400M Programme had been placed."                                                                   
[27] "- On 13 March 2013, the European Aviation Safety Agency granted a Full Type Certificate to A400M."                                                           
[28] "- On 31 July 2013, the Partner Nations granted Type Acceptance at the Initial Operating Clearance for the A400M Atlas Aircraft."                             
[29] "- In early August 2013, the first aircraft was delivered to France."                                                                                         
[30] "- In November 2013, the second A400M Atlas was delivered to France."                                                                                         
[31] "- On 3 December 2013, the Defence Board agreed to exchange two aircraft production slots with France."                                                       
[32] "- On 30 January 2014, the Investment Approvals Committee retrospectively approved the UK contribution to the Export Levy Facility."                          
[33] "- In February 2014, the A400M in Service Support Main Gate Business Case was submitted to the Investment Approvals Committee."                               
[34] "- On 6 November 2013, the planned Review Note to include the Cargo Hold Trainer in the Training Service was approved."                                       
[35] "- On 15 November 2013, a contract amendment was signed for the procurement of the Cargo Hold Trainer."                                                       
[36] "- On 28 March 2014, the A400M Schoolhouse at RAF Brize Norton was completed and accepted off contract."                                                      </code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>