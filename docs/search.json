[
  {
    "objectID": "posts/welcome/index.html",
    "href": "posts/welcome/index.html",
    "title": "Welcome to the LFE Database Blog",
    "section": "",
    "text": "Welcome to the LFE database creation blog. This is used to document the development of the LFE database."
  },
  {
    "objectID": "posts/exploratory-data-analysis/eda.html",
    "href": "posts/exploratory-data-analysis/eda.html",
    "title": "Exploratory Data Analysis",
    "section": "",
    "text": "Show the code\nlibrary(ggplot2)\nlibrary(plotly)"
  },
  {
    "objectID": "posts/exploratory-data-analysis/eda.html#number-of-projects-by-year-and-phase",
    "href": "posts/exploratory-data-analysis/eda.html#number-of-projects-by-year-and-phase",
    "title": "Exploratory Data Analysis",
    "section": "Number of Projects by Year and Phase",
    "text": "Number of Projects by Year and Phase\nThe chart below shows the number of projects per year and by phase of project.\n\n\nShow the code\ng &lt;- project_meta |&gt;\n  dplyr::group_by(project_type_label, year) |&gt;\n  dplyr::count()  |&gt;\n  ggplot(aes(year, n)) + \n  geom_bar(aes(fill = project_type_label), stat = \"identity\") \n\nggplotly(g)"
  },
  {
    "objectID": "posts/exploratory-data-analysis/eda.html#project-by-type",
    "href": "posts/exploratory-data-analysis/eda.html#project-by-type",
    "title": "Exploratory Data Analysis",
    "section": "Project by Type",
    "text": "Project by Type\nThe chart below shows the count of project types by project.\n\n\nShow the code\ng &lt;- project_meta  |&gt;\n  dplyr::mutate(\n    project_label = ifelse(\n      test = nchar(project_label)&gt;30, \n      yes = paste0(substr(project_label, 1, 30),\"...\"),\n      no = project_label\n    )\n  ) |&gt;\n  dplyr::group_by(project_label, project_type_label) |&gt;\n  dplyr::count() |&gt;\n  ggplot() + \n  geom_bar(\n    aes(x = factor(project_label,rev(unique(project_label))), \n        y = n, \n        fill = project_type_label), \n    stat = \"identity\") + \n  coord_flip() +\n  labs(x = \"\", y = \"\", fill = \"\")\n\nggplotly(g, height = 1000)"
  },
  {
    "objectID": "posts/exploratory-data-analysis/eda.html#project-by-year-and-type",
    "href": "posts/exploratory-data-analysis/eda.html#project-by-year-and-type",
    "title": "Exploratory Data Analysis",
    "section": "Project by Year and Type",
    "text": "Project by Year and Type\nThe heatmap below shows the project, year and project type.\n\n\nShow the code\ng &lt;- project_meta |&gt;\n  dplyr::mutate(\n    project_label = ifelse(\n      test = nchar(project_label)&gt;30, \n      yes = paste0(substr(project_label, 1, 30),\"...\"),\n      no = project_label\n    )\n  ) |&gt;\n  dplyr::group_by(project_label,project_type_label, year) |&gt;\n  dplyr::count()  |&gt;\n  ggplot() + \n  geom_tile(\n    aes(\n      x = year, \n      y = factor(project_label,rev(unique(project_label))),\n      fill = project_type_label)\n    ) +\n  labs(x = \"\", y = \"\", fill = \"\")\n\nggplotly(g, height = 1000)"
  },
  {
    "objectID": "posts/exploratory-data-analysis/eda.html#project-by-section",
    "href": "posts/exploratory-data-analysis/eda.html#project-by-section",
    "title": "Exploratory Data Analysis",
    "section": "Project by Section",
    "text": "Project by Section\nThe chart below shows a count of level 1 headings by year for D&M phase projects.\nThe data suggests that the report changed format in 2009. It also suggests that there is a need to go back and clean the headings for data from 2009 as there are many level 2 headings mislabelled as level 1 headings.\n\n\nShow the code\nd &lt;- \"../../data-raw/naomprss\"\nf &lt;- list.files(d, pattern = \"md\")\nsections &lt;- purrr::map_df(file.path(d, f), ~{\n  \n  text_in &lt;- readLines(.x) \n  heading_i &lt;- text_in |&gt;\n    stringr::str_detect(\"^#\") |&gt;\n    which()\n  \n  file &lt;- unlist(stringr::str_split(.x, \"/\"))\n  file &lt;- tools::file_path_sans_ext(file[length(file)])\n  \n  file_split &lt;- unlist(stringr::str_split(file, \"_\"))\n  year &lt;- file_split[2]\n  page_from = file_split[3]\n  page_to = file_split[4]\n  \n  df &lt;- dplyr::tibble(\n    heading = text_in[heading_i],\n    from = heading_i\n  ) |&gt;\n    dplyr::mutate(\n      to = dplyr::lead(from)-1\n    ) |&gt;\n    tidyr::replace_na(list(to = length(heading_i))) |&gt;\n    dplyr::mutate(year = as.numeric(year),\n                  page_from = as.numeric(page_from),\n                  page_to = as.numeric(page_to)) \n  \n  chars &lt;- df |&gt; purrr::pmap_dbl(function(from, to, ...){\n    nchar(paste(text_in[from:to], collapse = \"\\n\"))\n  })\n  \n  df$nchar &lt;- chars\n  return(df)\n})\n\nproject_section &lt;- sections |&gt; \n  dplyr::left_join(project_meta,\n    by = c(\"year\", \"page_from\", \"page_to\")\n  )\n\n\ng &lt;- project_section |&gt;\n  dplyr::filter(project_type_label == \"D&M\") |&gt;\n  dplyr::filter(stringr::str_detect(heading, \"^# \")) |&gt;\n  dplyr::mutate(heading = ifelse(\n    test = nchar(heading &gt; 30),\n    yes = paste0(substr(heading, 1, 30), \"...\"),\n    no = heading\n  )) |&gt;\n  dplyr::group_by(year, heading)  |&gt;\n  dplyr::count() |&gt;\n  ggplot() + geom_bar(aes(heading, n), stat = \"identity\") +\n  facet_grid(year ~ ., scales = \"free\", drop = TRUE, space = \"free_y\") + \n  coord_flip()\n\nggplotly(g, height = 2000)\n\n\n\n\n\n\nIn the modelling phase we extract the issues from projects within their D&M phase between 2005 and 2008.\nThe chart below shows the number of headings by year for D&M phase projects.\nThe data are mostly well formed. Some further cleaning to create uniform headers could be carried out.\n\n\nShow the code\ng &lt;- project_section |&gt;\n  dplyr::filter(project_type_label == \"D&M\") |&gt;\n  dplyr::filter(year &lt; 2009) |&gt;\n  group_by(heading, year) |&gt;\n  dplyr::count() |&gt;\n  dplyr::arrange(-n, heading) |&gt;\n  ggplot() + geom_bar(aes(factor(heading, rev(unique(heading))), n, fill = as.factor(year)), stat = \"identity\") +\n  coord_flip() +\n  theme(legend.position = \"bottom\") + \n  labs(x = \"\", y = \"\", fill = \"\")\n\nggplotly(g, height = 1000)"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "This blog documents the process for extracting unstructured opensource information to a structured database."
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Creating LFE Database",
    "section": "",
    "text": "What can be learned from the delivery of A400M\n\n\n\n\n\n\ngpt\n\n\na400m\n\n\n\n\n\n\n\n\n\nFeb 22, 2024\n\n\nLuke Heley\n\n\n\n\n\n\n\n\n\n\n\n\nExploratory Data Analysis\n\n\n\n\n\n\neda\n\n\n\n\n\n\n\n\n\nFeb 20, 2024\n\n\nLuke Heley\n\n\n\n\n\n\n\n\n\n\n\n\nUsing GPT with R\n\n\n\n\n\n\nmethod\n\n\nllm\n\n\n\n\n\n\n\n\n\nFeb 20, 2024\n\n\nLuke Heley\n\n\n\n\n\n\n\n\n\n\n\n\nWelcome to the LFE Database Blog\n\n\n\n\n\n\nnews\n\n\n\n\n\n\n\n\n\nFeb 20, 2024\n\n\nLuke Heley\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "posts/using-chat-gpt-with-r/using-chat-gpt-with-r.html",
    "href": "posts/using-chat-gpt-with-r/using-chat-gpt-with-r.html",
    "title": "Using GPT with R",
    "section": "",
    "text": "The code chunk below shows how to extract issues from a chunk of text using Chat GPT.\n\nShow the code\nsection_md &lt;- readLines(\"example.md\") |&gt; paste(collapse = \"\\n\")\n\nWarning in readLines(\"example.md\"): incomplete final line found on 'example.md'\n\nShow the code\nsection_md\n\n[1] “## 1a. Project description, progress and key future eventsall-weather, 24 hours, general-purpose bombing requirement which offered increased accuracy to reduce collateral damage was identified during the 1991 Gulf War and re-emphasised in subsequent operations. The Precision Guided Bomb (PGB) programme was established to meet this requirement and Raytheon Systems Limited (RSL), who offered the Paveway IV weapon, was selected as the Prime Contractor following international competition. Investment Appraisals Board (IAB) approval was given in June 2003 for the procurement of the Weapon System and integration onto Harrier, Tornado and Typhoon aircraft. Contract let was planned for September 2003 however, Departmental funding constraints delayed contract let and limited it to placement of the main Weapon, support and Harrier GR9 Integration Contracts. These contracts were let in December 2003. A further submission will be made once the way forward for Tornado and Typhoon integration becomes clear.contract let it has been decided to enhance further the weapon through the addition of LASER capability. This enhancement is mutually beneficial to RSL and MOD and is being delivered at no extra cost to the MOD. Progress to date is satisfactory and so far all milestones, including the Weapon System Critical Design Review, have been achieved on time or ahead of schedule. Development hardware has been provided and the qualification programme is well underway.delay to contract let is reflected in a pro-rata slip to the Main Gate In Service Date estimates although work is ongoing across the stakeholder community to recover this slip. The effect of the recovery work will become evident later in 2006 once the initial results of the qualification phase are known.”\n\n\nShow the code\nlibrary(httr)\n\nkey &lt;- Sys.getenv(\"OPENAI_API_KEY\")\n\nbody &lt;- list(model = \"gpt-3.5-turbo\",\n   messages = list(list(\n     role = \"user\",\n     content = glue::glue(\"list the issues identified in the following text: {section_md}\")\n     )),\n     temperature = 0.7) |&gt;\njsonlite::toJSON(auto_unbox = TRUE)\n\nresp &lt;- POST(url = \"https://api.openai.com/v1/chat/completions\",\n     add_headers(`Content-Type` = \"application/json\",\n                   Authorization = glue::glue(\"Bearer {key}\")),\n     body = body)\n\n\n\ncontent(resp)\n\n\n$id\n[1] \"chatcmpl-8vQmLLKyH8Kwd0CI0MI2s7hilY4hb\"\n\n$object\n[1] \"chat.completion\"\n\n$created\n[1] 1708698325\n\n$model\n[1] \"gpt-3.5-turbo-0125\"\n\n$choices\n$choices[[1]]\n$choices[[1]]$index\n[1] 0\n\n$choices[[1]]$message\n$choices[[1]]$message$role\n[1] \"assistant\"\n\n$choices[[1]]$message$content\n[1] \"1. Departmental funding constraints delaying contract let\\n2. Uncertainty surrounding integration onto Tornado and Typhoon aircraft\\n3. Pro-rata slip to the Main Gate In Service Date estimates\\n4. Recovery work needed to address delays\\n5. Potential impact on project timeline and milestones.\"\n\n\n$choices[[1]]$logprobs\nNULL\n\n$choices[[1]]$finish_reason\n[1] \"stop\"\n\n\n\n$usage\n$usage$prompt_tokens\n[1] 360\n\n$usage$completion_tokens\n[1] 58\n\n$usage$total_tokens\n[1] 418\n\n\n$system_fingerprint\n[1] \"fp_86156a94a0\""
  },
  {
    "objectID": "posts/a400m/a400m.html",
    "href": "posts/a400m/a400m.html",
    "title": "What can be learned from the delivery of A400M",
    "section": "",
    "text": "This article extracts data on what went well and what went less well about the delivery of A400M using the Chat GPT Large Language Model."
  },
  {
    "objectID": "posts/a400m/a400m.html#how-has-the-description-of-the-requirement-changed-between-2009-2015",
    "href": "posts/a400m/a400m.html#how-has-the-description-of-the-requirement-changed-between-2009-2015",
    "title": "What can be learned from the delivery of A400M",
    "section": "How has the description of the requirement changed between 2009-2015?",
    "text": "How has the description of the requirement changed between 2009-2015?\n\n\nShow the code\ncontext &lt;- text |&gt;\n  dplyr::filter(common_label == \"the requirement\") |&gt;\n  dplyr::mutate(text = paste(\"project: 'A400m'\\nyear:\",year,\"\\n\",\n                             text)) |&gt;\n  dplyr::pull(text)  |&gt;\n  paste(collapse = \"\\n```\\n\")\n\nquestion &lt;- \"How has the description of the requirement for A400M changed over time?\"\n\nq_1 &lt;- query_gpt(question, context)\nsaveRDS(q_1, \"q_1.RDS\")\n\n\n\n\nShow the code\nq_1 &lt;- readRDS(\"q_1.RDS\")\nq_1$choices[[1]]$message$content\n\n\n[1] \"The description of the requirement for A400M has not changed over time. It has consistently been described as a vehicle intended to provide tactical and strategic mobility to all three services, with the ability to operate from airfields and semi-prepared rough landing areas in extreme climates and all weather conditions by day and night. It is also required to carry a variety of equipment including vehicles and troops over extended ranges, air drop paratroops and equipment, and be unloaded with the minimum of ground handling equipment. The A400M is also intended to replace the remaining Hercules C-130k fleet.\""
  },
  {
    "objectID": "posts/a400m/a400m.html#describe-the-in-year-progress-of-the-a400m-project",
    "href": "posts/a400m/a400m.html#describe-the-in-year-progress-of-the-a400m-project",
    "title": "What can be learned from the delivery of A400M",
    "section": "Describe the in-year progress of the A400M Project",
    "text": "Describe the in-year progress of the A400M Project\n\n\nShow the code\ncontext &lt;- text |&gt;\n  dplyr::mutate(\n    text = glue::glue(\n      \"project: A400M\",\n      \"year: {year}\",\n      \"{text}\",\n      .sep = \"\\n\"\n      )\n    ) |&gt;\n  dplyr::group_by(year) |&gt;\n  dplyr::summarise(text = paste(text, collapse = \"\\n```\\n\")) \n\nin_year_summary &lt;- 2006:2015 |&gt;\n  purrr::map(~{\n    context_ &lt;- context |&gt; \n      dplyr::filter(year == .x) |&gt;\n      dplyr::pull(text)\n    \n    question &lt;- glue::glue(\n      \"Summarise the in year progress for A400M in year:{.x}\",\n      \"Describe what when went, what went less well and what can be improved.\",\n      .sep = \"\\n\")\n    \n      query_gpt(question, context_)\n  })\n\nsaveRDS(in_year_summary, \"q_2.RDS\")\n\n\n\n\nShow the code\nin_year_summary &lt;- readRDS(\"q_2.RDS\")\nin_year_summary |&gt; purrr::map(~.x$choices[[1]]$message$content)\n\n\n[[1]]\n[1] \"In 2006, the A400M project, a collaborative programme involving seven European nations, was in its design phase which was nearing completion. Manufacturing activities had also commenced. The project aims to provide tactical and strategic mobility to all three services, with capabilities including operations from airfields and semi-prepared rough landing areas in extreme climates and all weather conditions, carrying a variety of equipment over extended ranges, air dropping paratroops and equipment, and being unloaded with minimum ground handling equipment. The first flight was scheduled for 2008 and the first UK aircraft was expected to be delivered to the Royal Air Force in 2010. The context does not provide specific details on what went well or less well in 2006, or what could be improved.\"\n\n[[2]]\n[1] \"In 2007, the A400M project was in its design phase, nearing completion, and manufacturing activities had begun. The project was a collaboration between seven European nations, with a total of 180 aircraft being procured, 25 of which were for the UK. The A400M was selected to meet the airlift capability requirements of the Strategic Defence Review, and is planned to replace the remaining Hercules C-130k fleet. The first flight was scheduled for 2008 and the first UK aircraft was scheduled to be delivered to the Royal Air Force in 2010. The context does not provide specific details on what went well or less well, or what could be improved in 2007.\"\n\n[[3]]\n[1] \"The A400M project in 2008 was in the design phase, nearing completion, and manufacturing activities had begun. The project involves seven European nations with a total of 180 aircraft being procured, 25 of which are for the UK. The A400M is expected to provide tactical and strategic mobility to all three services, with capabilities such as operating from airfields and semi-prepared rough landing areas in extreme climates and all weather conditions. It is also expected to carry a variety of equipment including vehicles and troops over extended ranges, air drop paratroops and equipment, and be unloaded with minimum ground handling equipment. The first flight was expected in the financial year 2008-2009 and delivery of the first UK aircraft to the Royal Air Force in the financial year 2010-2011. The context does not provide specific information on what went less well and what can be improved in 2008.\"\n\n[[4]]\n[1] \"In 2009, the A400M project faced significant challenges. Airbus announced delays in the delivery date and a slowdown in the initial aircraft production rates. The first flight of the prototype aircraft, initially due in January 2008, was postponed until the second half of 2009. In December 2008, Airbus proposed a new approach to the A400M programme, which included revising the production schedule. However, full details of the revised schedule were still to be provided. Based on preliminary information, it was estimated that initial UK deliveries could not start before 2013. Despite these setbacks, there were positive developments, such as the roll-out of the first prototype aircraft at the Airbus Military Final Assembly Line Facility in Seville in June 2008 and the first flight of the specially developed TP-400D engine on the Flying Test Bed in late December 2008. By the end of March 2009, six flights of the Flying Test Bed had occurred.\"\n\n[[5]]\n[1] \"In 2010, the A400M project saw the first flight of the prototype in December 2009, and the continuation of flight trials in March 2010. However, the project faced challenges, with Airbus announcing in November 2008 that the first flight might not happen until the second half of 2009. In January 2009, Airbus proposed a new approach to the program and announced that they wished to discuss the program schedule and certain technical characteristics of the aircraft with customers. The UK and its partner nations agreed to a \\\"standstill\\\" agreement with Airbus Military to discuss possible options and outcomes for the A400M program. The renegotiation phase revealed that the A400M program would only remain viable with further investment from partner nations. The UK managed this additional funding through a reduction in the number of aircraft it receives. The principal factor for the delay to the program was its technical complexity, and poor management and control by Airbus Military. The program remained in a volatile and uncertain position while negotiations towards a revised contract continued. The Department planned to carry out a thorough review of the program later in 2010 when the revised program was established.\"\n\n[[6]]\n[1] \"In 2011, the A400M project, a collaborative programme involving seven European nations, was progressing towards its goal of providing tactical and strategic mobility to all three services. The design phase was nearing completion and manufacturing activities had begun. The first UK aircraft was expected to be delivered to the Royal Air Force in 2014.\\n\\nThe Strategic Defence and Security Review in October 2010 confirmed A400M as a component of the future RAF Air Transport Fleet. It also announced the earlier withdrawal of the Hercules C-130j Tactical Air Transport Aircraft from service in 2022 instead of 2030. \\n\\nIn March 2010, an agreement was reached to re-baseline the programme, setting the framework for contract amendment negotiations. These negotiations continued until November 2010, with the amended contract signed on 7 April 2011. As a result, the UK would receive 22 A400M, three less than originally expected.\\n\\nPositive achievements in 2011 included the addition of three more prototype aircraft to the flight trials fleet, which had amassed over 1404 flying hours by 27 March 2011. The A400M made its first visit to the UK, landing at its future main operating base RAF Brize Norton on 16 July 2010.\"\n\n[[7]]\n[1] \"In 2012, the A400M project made steady progress, with the revised aircraft production and delivery schedules remaining on track. Quarterly review meetings indicated that Airbus Military was making consistent progress. Investigation into engine problems encountered in 2011 concluded and solutions were developed, causing some disruption to the flight trials programme but not expected to significantly impact the aircraft production schedule. By the end of March 2012, all flight trials associated with the initial type certificate clearance, except for long distance endurance flying, were completed. The European Aviation Safety Agency granted a restricted type certificate in late April 2012. The first flight of the fifth and final prototype aircraft took place on 20 December 2011, and by 25 March 2012, the trials fleet had amassed 2944 flying hours and 1002 test flights.\"\n\n[[8]]\n[1] \"In 2013, the UK A400M Training Service achieved Main Gate Approval and will now be reported as a separate increment to the main A400M Programme. The original Main Gate Approval, which included elements of initial training and initial in-service support, was separated out and the A400M budgeted for and highest approved figures were adjusted to reflect this change. In anticipation of the achievement of UK A400M in Service Support Main Gate Approval later in the year, these elements of the original Main Gate Approval were also extracted. \\n\\nAt the Farnborough International Airshow in July 2012, it was announced that an order for the first UK A400M Full Flight Simulator had been agreed. On 4 March 2013, two further contracts relating to the A400M Programme were placed. The Training Service Support Contract will provide a specialist training school for personnel who will operate, support and maintain the A400M. A separate contract for the development, manufacture and installation of modifications required to operate the Large Aircraft Infrared Countermeasures Defensive Aids System when flying in hostile environments has also been let. \\n\\nThe European Aviation Safety Agency granted a Full Type Certificate to A400M on 13 March 2013 after the conclusion of all of the required flight trials activity. \\n\\nThe progress of the project could be improved by avoiding delays and ensuring that all necessary approvals and contracts are in place in a timely manner. The project could also benefit from a more streamlined and efficient process for the development, manufacture and installation of necessary modifications.\"\n\n[[9]]\n[1] \"In 2014, the A400M project saw significant progress with the delivery of the first two A400M Atlas aircrafts to France, marking important milestones in the multinational aircraft production and delivery programme. The multinational flight trials programme had amassed over 6,000 flying hours by the end of March 2014, providing further evidence of the capability and design maturity of the new aircraft. The UK was set to receive two of its order of 22 A400M Atlas aircraft earlier than previously planned due to an exchange of two aircraft production slots with France. However, UK aircraft deliveries were still forecast to commence in the latter part of 2014. The A400M Schoolhouse at RAF Brize Norton was completed on schedule and accepted off contract on 28 March 2014. \\n\\nHowever, the A400M in Service Support Main Gate Business Case was still awaiting final endorsement and approval by Ministers and Her Majesty’s Treasury at the end of March 2014. Consequently, in Service Support was not reported as an increment in the year's report. Approval of the Business Case was anticipated early in the next financial year. \\n\\nFor improvement, the project could benefit from faster approval processes to ensure that all aspects of the project, including in Service Support, are included in the annual report.\"\n\n[[10]]\n[1] \"In 2015, progress for the A400M project included the delivery of the first UK aircraft, ZM400, to RAF Brize Norton in November 2014. The UK became the third partner nation to operate the A400M. The aircraft was officially named “City of Bristol” in a ceremony held in February 2015. The second RAF A400M aircraft, ZM402, arrived at RAF Brize Norton in February 2015. However, there were issues with the A400M programme and a revised baseline and delivery schedule was announced by the Airbus Group in February 2015. The UK revised its forecast of achievement of in service date from March to September 2015 due to these delays. The first A400M export customer, Malaysia, took delivery of MSN022 in March 2015.\""
  },
  {
    "objectID": "posts/a400m/a400m.html#how-has-the-in-service-date-changed-over-time-and-what-if-any-have-been-the-operational-impacts",
    "href": "posts/a400m/a400m.html#how-has-the-in-service-date-changed-over-time-and-what-if-any-have-been-the-operational-impacts",
    "title": "What can be learned from the delivery of A400M",
    "section": "How has the in-service date changed over time and what, if any, have been the operational impacts?",
    "text": "How has the in-service date changed over time and what, if any, have been the operational impacts?\n\n\nShow the code\ntbls &lt;- all_text |&gt;\n  dplyr::filter(section == 3) |&gt;\n  dplyr::group_by(year) |&gt;\n  dplyr::summarise(text = paste(text, collapse = \"\\n\")) |&gt;\n  dplyr::pull(text) |&gt;\n  purrr::map(rvest::read_html) |&gt;\n  purrr::map(rvest::html_table) \n\n\n\n\nShow the code\ntbls[[10]][[3]][,2] |&gt; dplyr::pull()\n\n\n[1] \"In-Service Date Defined as Delivery of the Seventh Aircraft with Military Aircraft Release and Support Arrangements.\"\n\n\nShow the code\nisd &lt;- tbls |&gt;\n  purrr::imap(~{\n    if(.y&lt;=3){\n      t(.x[[2]]) |&gt; \n        dplyr::as_tibble(.name_repair = \"universal\") |&gt;\n        dplyr::slice(2) |&gt;\n        rlang::set_names(c(\"forecast_isd\", \"approved_isd\", \n                           \"variation\", \"var_in_year\")) |&gt;\n        dplyr::mutate(project = \"a400m\") |&gt;\n        purrr::map(as.character) |&gt;\n        dplyr::as_tibble()\n    } else{\n      .x[[4]]  |&gt;\n        dplyr::as_tibble() |&gt;\n        rlang::set_names(c(\"project\",  \"approved_isd\", \"forecast_isd\",\n                           \"variation\", \"var_in_year\")) |&gt;\n        purrr::map(as.character) |&gt;\n        dplyr::as_tibble()\n    }\n  }) |&gt;\n  dplyr::bind_rows() |&gt;\n  dplyr::mutate(report = 2006:2015)\n\nisd\n\n\n\n  \n\n\n\nThe approved ISD was February 2009 (@50%) [December 2009 @90%].\nThe reason for the variation is in the table below.\n\n\nShow the code\npurrr::imap(tbls, ~{\n  tbl &lt;- if(.y&lt;=3) .x[[3]] else .x[[5]]\n  names(tbl) &lt;- c(\"date\", \"var\", \"category\", \"reason\")\n  if(.y == 1) tbl else tbl |&gt; dplyr::filter(date != \"historic\")\n}) |&gt;\n  dplyr::bind_rows() |&gt;\n  dplyr::filter( !stringr::str_detect(tolower(date), \"net|total\")) |&gt;\n  dplyr::filter(category != \"Risk Differential\")\n\n\n\n  \n\n\n\n\n\nShow the code\ntbls[[10]][[6]][,2] |&gt; dplyr::pull()\n\n\n[1] \"Reported in MPR 2015: The Further Six Month Delay to the UK Declaration of in Service Date is not Expected to Have any Direct Impact on the Delivery of UK Military Capability. Delivery Dates for Future Capability Increments Forecast by Airbus Defence and Space are not Affected by Current Production Delays, and Align with UK Capability Milestones.\"\n[2] \"Reported in MPR 2009: The Revised Forecast A400M in Service Date No Longer Aligns with the C-130k Out of Service Date of 2013. This Increases the Pressure on Existing Tactical Airlift Capability from 2013 to 2015. Interim Measures to Mitigate this Include Action to Increase the Availability of the Remaining C-130j Fleet.\""
  }
]